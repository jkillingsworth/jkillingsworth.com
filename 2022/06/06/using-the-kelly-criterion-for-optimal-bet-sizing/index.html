<!doctype html><html lang="en-US"><head><title>Using the Kelly Criterion for Optimal Bet Sizing - Jim Killingsworth</title><meta charset="utf-8"/><meta name="referrer" content="no-referrer-when-downgrade"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="description" content="Suppose a gambler is playing a game in which he has a statistical advantage. And let’s assume he can quantify his advantage with a fair amount of accuracy. If the gambler plays this game over and over again, what percentage of his bankroll should he bet on each round if he wants to maximize his winnings? In this post, I explore this question using a series of examples illustrating the application of the Kelly criterion. Many of the ideas presented here are inspired by materials written by Ed Seykota, Edward O. Thorp, and J. L. Kelly."/><base href="/"/><link rel="canonical" href="https://jkillingsworth.com/2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/"/><link rel="icon" href="./static/favicon.ico" type="image/x-icon"/><link rel="icon" href="./static/favicon-256.jpg" sizes="256x256"/><link rel="preload" href="./static/fonts/open-sans-v29-latin-700.woff2" as="font" crossorigin/><link rel="preload" href="./static/fonts/lora-v25-latin-regular.woff2" as="font" crossorigin/><link rel="preload" href="./static/fonts/lora-v25-latin-italic.woff2" as="font" crossorigin/><link rel="preload" href="./static/fonts/roboto-mono-v22-latin-regular.woff2" as="font" crossorigin/><script src="https://www.googletagmanager.com/gtag/js?id=G-KP25LH29N8" async></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag("js", new Date());
  gtag("config", "G-KP25LH29N8");
</script><style>@font-face{font-display:swap;font-family:"Open Sans";font-style:normal;font-weight:700;src:local("Open Sans Bold"),local("OpenSans-Bold"),url(./static/fonts/open-sans-v29-latin-700.woff2) format("woff2"),url(./static/fonts/open-sans-v29-latin-700.woff) format("woff")}@font-face{font-display:swap;font-family:"Lora";font-style:normal;font-weight:400;src:local("Lora Regular"),local("Lora-Regular"),url(./static/fonts/lora-v25-latin-regular.woff2) format("woff2"),url(./static/fonts/lora-v25-latin-regular.woff) format("woff")}@font-face{font-display:swap;font-family:"Lora";font-style:italic;font-weight:400;src:local("Lora Italic"),local("Lora-Italic"),url(./static/fonts/lora-v25-latin-italic.woff2) format("woff2"),url(./static/fonts/lora-v25-latin-italic.woff) format("woff")}@font-face{font-display:swap;font-family:"Roboto Mono";font-style:normal;font-weight:400;src:local("Roboto Mono"),local("RobotoMono-Regular"),url(./static/fonts/roboto-mono-v22-latin-regular.woff2) format("woff2"),url(./static/fonts/roboto-mono-v22-latin-regular.woff) format("woff")}
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:0.35em 0.75em 0.625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}
html{box-sizing:border-box;overflow-y:scroll}*,*::before,*::after{box-sizing:inherit}body{font-family:"Lora", "Georgia", serif;font-weight:normal;background:#fff;color:#000;display:flex;flex-flow:row wrap;font-size:12pt;justify-content:space-between;line-height:1.5;margin:0 auto;width:90%}body>*{flex:100%}body>header{font-size:21pt;margin:10px 0}body>footer{border-top:3px solid gray;font-size:10pt;font-style:italic;padding:16px 0}header,nav,h1,h2{font-family:"Open Sans", "Verdana", sans-serif;font-weight:bold}header a,nav a,h1 a,h2 a{color:inherit}a{color:#0050ff;text-decoration:none}a:hover{color:#0050ff;text-decoration:underline}strong{font-family:"Open Sans", "Verdana", sans-serif;font-weight:bold}svg{fill:currentColor}.navmenu{border-top:3px solid gray;border-bottom:1px solid #ccc}.navmenu #toggle{float:right;height:24px;margin:4px 0;width:24px}.navmenu #toggle+label{color:transparent;cursor:pointer;display:block;padding:4px 0;position:relative;user-select:none;-moz-user-select:none;-ms-user-select:none;-webkit-user-select:none}.navmenu #toggle+label::before{background:#fff;background-size:24px;content:"";float:right;height:24px;left:24px;position:relative;width:24px}.navmenu #toggle+label::after{content:"Menu";left:0;padding:0 16px;position:absolute}.navmenu #toggle+label{border-bottom:none}.navmenu #toggle+label::before{background-image:url("./static/chevron-down.svg")}.navmenu #toggle+label::after{color:#000}.navmenu #toggle~ul{height:0;visibility:hidden}.navmenu #toggle:checked+label{border-bottom:1px solid #e6e6e6}.navmenu #toggle:checked+label::before{background-image:url("./static/chevron-up.svg")}.navmenu #toggle:checked+label::after{color:gray}.navmenu #toggle:checked~ul{height:auto;visibility:visible}.navmenu ul{display:flex;flex-flow:column wrap;list-style-type:none;justify-content:flex-start;margin:0;overflow:hidden;padding:0}.navmenu ul>li{flex:none}.navmenu ul>li a{display:block;padding:4px 16px}.navmenu ul>li a:hover,.navmenu ul>li a:focus{background:gray;color:#fff}.content{max-width:720px}.content header,.content footer,.content h1,.content h2,.content p,.content ul,.content figure{margin:24px 0}.content h1{font-size:18pt}.content h2{font-size:12pt}.content footer{font-style:italic}.content p:last-of-type::after{clear:both;content:"";display:block}.content ul{padding-left:16px}.content ul>li{margin:12px 0}.content figure{max-width:90vw}.content figure>img{display:block}.content .fig-chart{padding-top:56.25%;page-break-inside:avoid;position:relative}.content .fig-chart>img{max-height:100%;max-width:100%;position:absolute;top:0}.content .fig-latex{overflow-x:auto}.content .fig-latex>img{margin:0 16px}.content .fig-pic-l>img,.content .fig-pic-r>img{margin:0 auto;max-width:100%;object-fit:cover}.content .button{font-family:"Open Sans", "Verdana", sans-serif;font-weight:bold;background:#e6e6e6;color:inherit;display:block;margin:24px 0;padding:4px 0;text-align:center}.content .button:hover,.content .button:focus{background:gray;color:#fff}.content .message header>h1{background:#ffff60;display:inline-block;font-size:12pt;margin:0;text-transform:lowercase}.content .message header>h1::first-letter{text-transform:uppercase}.content .message header>h1::after{content:":"}.content .message p{font-style:italic}.content .newpost header>h1{background:#ffff60;display:inline-block;font-size:12pt;margin:0;text-transform:lowercase}.content .newpost header>h1::first-letter{text-transform:uppercase}.content .newpost header>h1::after{content:":"}.content .newpost header>h2{font-size:18pt}.content .newpost a.readmore{background:#e8f0ff}.content .newpost a.readmore::after{content:" \00bb"}.content .newpost a:not(.readmore):not(:hover){color:inherit}.content .oldpost{margin:24px 0}.content .oldpost header>h1{display:none}.content .archive ul>li time{font-family:"Roboto Mono", "Consolas", "Menlo", monospace;font-weight:normal;display:none;font-size:10pt}.content .contact label,.content .contact input[type="submit"]{font-family:"Open Sans", "Verdana", sans-serif;font-weight:bold;cursor:pointer;display:block;margin:16px 0}.content .contact label{margin-bottom:4px}.content .contact input[type="text"],.content .contact input[type="email"],.content .contact textarea{font-family:"Roboto Mono", "Consolas", "Menlo", monospace;font-weight:normal;display:block;font-size:10pt;line-height:inherit;padding:4px;width:100%}.content .contact textarea{height:200px;max-width:100%;min-width:100%}.content .contact input[type="submit"]{padding:4px 40px}.content .comments{margin:24px 0 8px}.content .comments header>h2{display:none}.content .comments noscript{font-family:"Roboto Mono", "Consolas", "Menlo", monospace;font-weight:normal;display:block;font-size:10pt;margin:-12px 0 24px}.sidebar header>h1{display:none}.sidebar header>h2{border-bottom:1px solid #ccc;border-top:3px solid gray;font-size:inherit;margin:0;padding:4px 0}.sidebar section{margin:24px 0}.sidebar section:first-of-type{margin-top:0}.sidebar .social-media ul{list-style:none;padding:0 0 0 16px}.sidebar .social-media ul>li a{display:inline-block}.sidebar .social-media ul>li a *{vertical-align:middle}.sidebar .social-media ul>li a span{margin:0 10px}.sidebar .social-media ul>li a svg{color:gray;height:48px;width:48px}.sidebar .social-media ul>li a:hover svg{color:inherit}.content p:not(.nojustify),.sidebar p:not(.nojustify){text-align:justify;word-spacing:-1px}.content p,.content ul,.sidebar p,.sidebar ul{line-height:1.667}@media only screen and (min-width: 600px){.content ul{padding-left:40px}.content ul>li{margin:0}.content .fig-latex>img{margin:0 40px}.content .fig-pic-l>img{float:left;margin:0 24px 0 0}.content .fig-pic-r>img{float:right;margin:0 0 0 24px}.content .archive ul>li time{display:inline}body{max-width:720px}body>header{font-size:24pt}.navmenu #toggle{display:none}.navmenu #toggle+label{display:none}.navmenu #toggle~ul{height:auto;visibility:visible}.navmenu ul{flex-flow:row wrap}.navmenu ul>li a{padding:4px 32px}}@media only screen and (min-width: 1200px){body{column-gap:60px;max-width:1200px;min-width:1080px}body>header{text-align:center}.content{flex:auto;width:720px}.sidebar{flex:auto}.sidebar section:first-of-type{margin-top:40px}}@media only print{.content ul{padding-left:40px}.content ul>li{margin:0}.content .fig-latex>img{margin:0 40px}.content .fig-pic-l>img{float:left;margin:0 24px 0 0}.content .fig-pic-r>img{float:right;margin:0 0 0 24px}.content .archive ul>li time{display:inline}body{display:block;margin:auto;width:125%}body>header{border-bottom:1px solid #ccc;border-top:3px solid gray;font-size:inherit;margin:0;padding:4px 0;text-align:left}.content figure{max-width:100%}.navmenu,.sidebar,.oldpost,.comments{display:none}}@page{margin:1in 1.25in}
</style></head><body><header><a href="./">Jim Killingsworth</a></header><nav class="navmenu"><input id="toggle" type="checkbox"/><label for="toggle">Enable menu</label><ul><li><a href="./"> Home </a></li><li><a href="./archive/"> Archive </a></li><li><a href="./about/"> About </a></li><li><a href="./contact/"> Contact </a></li></ul></nav><main class="content"><article><header><h1>Us­ing the Kel­ly Cri­te­ri­on for Op­ti­mal Bet Siz­ing</h1></header><p>Sup­pose a gam­bler is play­ing a game in which he has a sta­tis­ti­cal ad­van­tage. And let’s as­sume he can quan­ti­fy his ad­van­tage with a fair amount of ac­cu­ra­cy. If the gam­bler plays this game over and over again, what per­cent­age of his bankroll should he bet on each round if he wants to max­i­mize his win­nings? In this post, I ex­plore this ques­tion us­ing a se­ries of ex­am­ples il­lus­trat­ing the ap­pli­ca­tion of the Kel­ly cri­te­ri­on. Many of the ideas pre­sent­ed here are in­spired by ma­te­ri­als writ­ten by Ed Seyko­ta, Ed­ward O. Thor­p, and J. L. Kel­ly.</p><h2 id="repeated-coin-toss-game">Re­peat­ed Coin Toss Game</h2><p>For our first ex­am­ple, let’s con­sid­er a re­peat­ed coin toss game. The gam­bler bets on the out­come of a coin toss. If he pre­dicts the out­come cor­rect­ly, he wins an amount equiv­a­lent to the size of his bet. If he is wrong, he los­es the amount he wa­gered. In this ex­am­ple, let’s as­sume the coin is bi­ased in such a way that it lands on heads 60% of the time and tails 40% of the time. We can rep­re­sent this us­ing the fol­low­ing no­ta­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-01-latex-1620035801.svg" alt="Figure 1" height="44"></figure><p>Let’s as­sume the gam­bler is aware of this bi­as. Of course, the gam­bler will al­ways bet on head­s. But how much should he bet? Should he bet 10% of his stake? Should he bet 20%? Per­haps he should bet 30%? Maybe more? Maybe less? This is the ques­tion we want to an­swer. If the gam­bler bets too high, he risks de­plet­ing his cap­i­tal too quick­ly dur­ing a los­ing streak. If he bets too low, his wealth may not grow as quick­ly as it might oth­er­wise. We can be­ing to an­swer this ques­tion by con­sid­er­ing an ex­am­ple and then con­struct­ing a mod­el. Sup­pose the gam­bler plays 200 rounds of the game and bets 10% on each play:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-02-latex-1370980916.svg" alt="Figure 2" height="40"></figure><p>And sup­pose the gam­bler starts with a bankroll of $100:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-03-latex-1594997715.svg" alt="Figure 3" height="18"></figure><p>Based on these num­ber­s, we can use the fol­low­ing for­mu­la to cal­cu­late the size of the gam­bler’s hold­ings af­ter play­ing 200 rounds of the game:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-04-latex-2046805621.svg" alt="Figure 4" height="30"></figure><p>Be­cause there is an el­e­ment of ran­dom­ness in­volved, there is no guar­an­tee that we will get the same re­sult every time we com­pute this val­ue. One se­ries of 200 coin toss­es might have a dif­fer­ent num­ber of heads and tails than an­oth­er se­ries. How­ev­er, the num­ber of heads and the num­ber of tails will al­ways add up to the same amoun­t:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-05-latex-1875325070.svg" alt="Figure 5" height="14"></figure><p>To get an idea of what kind of re­sults we can ex­pec­t, we can run some sim­u­la­tions of the coin toss game us­ing a ran­dom num­ber gen­er­a­tor to mim­ic the coin toss. Here is a graph­i­cal rep­re­sen­ta­tion of three such sim­u­la­tion­s:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-06-coin-toss-simulations.svg" alt="Figure 6" height="405" width="720"></figure><p>As you can see, these three dif­fer­ent sim­u­la­tions yield three very dif­fer­ent out­comes. The fol­low­ing ta­ble sum­ma­rizes the re­sult­s:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-07-latex-3731260542.svg" alt="Figure 7" height="135"></figure><p>To es­ti­mate the ex­pect­ed val­ue of the gam­bler’s hold­ings af­ter 200 rounds of the coin toss game, we might run this sim­u­la­tion many more times and then take the mean of the re­sult­s. That would tell us the ex­pect­ed val­ue for a bet size of 10%. We would then have to re­peat this process again for every pos­si­ble bet size to de­ter­mine which bet size val­ue gives us the high­est ex­pect­ed re­sult. That might be a com­pu­ta­tion­al­ly ex­pen­sive thing to do. A bet­ter ap­proach might be to look at this prob­lem an­a­lyt­i­cal­ly. Keep in mind that what we re­al­ly care about here is not the gam­bler’s wealth af­ter a spe­cif­ic num­ber of rounds of the coin toss game. What re­al­ly mat­ters is the geo­met­ric mean of all the gains and loss­es tak­en in ag­gre­gate:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-08-latex-0511057197.svg" alt="Figure 8" height="49"></figure><p>This gives us a growth rate fac­tor in­de­pen­dent of the num­ber of plays and the in­de­pen­dent of the gam­bler’s start­ing eq­ui­ty. This is the val­ue we want to max­i­mize. And specif­i­cal­ly, what we’re re­al­ly in­ter­est­ed in is the ex­pect­ed val­ue of the growth rate as a func­tion of the bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-09-latex-2133647443.svg" alt="Figure 9" height="24"></figure><p>As we will see short­ly, max­i­miz­ing the log­a­rithm of the growth rate is go­ing to be more con­ve­nient than max­i­miz­ing the growth rate it­self. For our pur­pos­es here, we will use the nat­ural log­a­rith­m. Con­sid­er the fol­low­ing:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-10-latex-0745853382.svg" alt="Figure 10" height="148"></figure><p>Since the nat­ural log­a­rithm is a monoton­i­cal­ly in­creas­ing func­tion, max­i­miz­ing the growth rate is the same as max­i­miz­ing its log­a­rith­m. As men­tioned, we are in­ter­est­ed in the ex­pect­ed val­ue of the growth rate. But in this case, it is the log­a­rithm of the growth rate:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-11-latex-2583958054.svg" alt="Figure 11" height="67"></figure><p>You can think about the ex­pect­ed val­ue in terms of the num­ber of heads and the num­ber of tail­s. If you play 200 round­s, the ex­pec­ta­tion is that the game will pro­duce 120 heads and 80 tail­s. This can vary based on ran­dom­ness, but these are the ex­pect­ed val­ues. We can plot the func­tion above to see what it looks like:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-12-example-1-gs.svg" alt="Figure 12" height="405" width="720"></figure><p>Us­ing vi­su­al in­spec­tion, we can ob­serve that the curve peaks where the bet size is 20%. But how do we solve this an­a­lyt­i­cal­ly? We want to be able to com­pute the most op­ti­mal bet size. Let’s use the fol­low­ing no­ta­tion to rep­re­sent the most op­ti­mal bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-13-latex-1625569630.svg" alt="Figure 13" height="34"></figure><p>The de­riv­a­tive of the growth rate func­tion is ze­ro at the max­i­mum, so we can say this:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-14-latex-0998881013.svg" alt="Figure 14" height="20"></figure><p>Ex­pand­ing out the de­riv­a­tive of the growth rate func­tion, we get this:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-15-latex-0928314274.svg" alt="Figure 15" height="35"></figure><p>Set­ting the de­riv­a­tive to ze­ro, we can solve for the op­ti­mal bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-16-latex-2271671085.svg" alt="Figure 16" height="39"></figure><p>We can sim­pli­fy this fur­ther know­ing that the sum of the prob­a­bil­i­ties adds up to one:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-17-latex-1181191844.svg" alt="Figure 17" height="17"></figure><p>Here is the sim­pli­fied so­lu­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-18-latex-0907859635.svg" alt="Figure 18" height="19"></figure><p>And now, plug­ging in the prob­a­bil­i­ty val­ues that quan­ti­fy the bias of the coin, we can com­pute the an­swer to our orig­i­nal ques­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-19-latex-1613702162.svg" alt="Figure 19" height="15"></figure><p>Thus, our gam­bler would max­i­mize his win­nings by bet­ting 20% of his cur­rent bankroll for each round of the coin toss game. We can even take it a step fur­ther and com­pute his ex­pect­ed growth for rate for a sin­gle round of the game. Con­sid­er the re­la­tion­ship be­tween the orig­i­nal growth rate func­tion and its log­a­rith­mic equiv­a­len­t:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-20-latex-2437147467.svg" alt="Figure 20" height="24"></figure><p>Us­ing the op­ti­mal bet size, we can cal­cu­late the op­ti­mal growth rate val­ues:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-21-latex-1358914445.svg" alt="Figure 21" height="45"></figure><p>So now, if our gam­bler bets 20% of his stake each round, he can ex­pect to in­crease his wealth by 2.03% every time he plays. Of course, this is just an ex­pec­ta­tion. The ac­tu­al re­sult will vary every round based on the ran­dom­ness of the game.</p><h2 id="different-payoffs">Dif­fer­ent Pay­offs</h2><p>In the pre­vi­ous ex­am­ple, the win­ning and los­ing amounts were the same. In this ex­am­ple, we are go­ing to see what hap­pens when there is an asym­met­ric pay­off rate. To make things in­ter­est­ing, we will start with a coin that on­ly lands on heads 30% of the time and tails for the re­main­ing 70% of the time:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-22-latex-4246536985.svg" alt="Figure 22" height="44"></figure><p>As with the pre­vi­ous ex­am­ple, the gam­bler al­ways bets on head­s. You might think this would be a los­ing propo­si­tion since there will be more los­ing rounds than win­ning round­s. But if the pay­off for a win­ning round is high­er than the loss suf­fered on a los­ing round, the gam­bler still might have an ad­van­tage when bet­ting on head­s. In this case, let’s say the gain is four times the loss:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-23-latex-0874922970.svg" alt="Figure 23" height="40"></figure><p>If the gam­bler choos­es a bet size of $1, he will on­ly lose $1 if the coin lands on tail­s. But if the coin lands on head­s, he will gain $4. This is enough to off­set the high­er loss rate. We can now up­date our mod­el of the game to ac­count for this type of asym­met­ric pay­of­f:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-24-latex-1846982524.svg" alt="Figure 24" height="30"></figure><p>So now the ques­tion is, how much should the gam­bler bet? What per­cent­age of his hold­ings should he wa­ger if he wants to max­i­mize his win­nings? We can do the same analy­sis as be­fore to come up with the log­a­rith­mic growth rate as a func­tion of the bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-25-latex-0492219510.svg" alt="Figure 25" height="19"></figure><p>This is sim­i­lar to the growth rate func­tion in the pre­vi­ous ex­am­ple. Ex­cept now, we have tak­en in­to con­sid­er­a­tion the asym­met­ric pay­off­s. Here is a plot of this func­tion:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-26-example-2-gs.svg" alt="Figure 26" height="405" width="720"></figure><p>Like we did in the pre­vi­ous ex­am­ple, we can find the max­i­mum growth rate by find­ing the point at which the de­riv­a­tive of the growth rate func­tion equals ze­ro. Here is the de­riv­a­tive of the growth rate func­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-27-latex-0800878365.svg" alt="Figure 27" height="35"></figure><p>Set­tings the de­riv­a­tive to ze­ro and solv­ing for the bet size, we can ar­rive at the op­ti­mal bet size that max­i­mizes the growth rate:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-28-latex-0402399174.svg" alt="Figure 28" height="37"></figure><p>Plug­ging in the val­ues, we get the con­crete so­lu­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-29-latex-0518393300.svg" alt="Figure 29" height="15"></figure><p>And now we can eval­u­ate the growth rate func­tion at the op­ti­mal bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-30-latex-0429245857.svg" alt="Figure 30" height="45"></figure><p>Ac­cord­ing to these cal­cu­la­tion­s, if the gam­bler us­es the op­ti­mal bet size of 12.5%, he can ex­pect to gain 2.86% every time he plays. De­spite los­ing more of­ten than he win­s, the gam­bler can still make a prof­it un­der the con­di­tions of this par­tic­u­lar game.</p><h2 id="multiple-outcomes">Mul­ti­ple Out­comes</h2><p>This ex­am­ple is a gen­er­al­iza­tion of the pre­vi­ous ones. In­stead of us­ing a coin toss, here we con­sid­er a bet­ting game in which there are six pos­si­ble out­comes. Each out­come has a dif­fer­ent prob­a­bil­i­ty. And each out­come has a dif­fer­ent pay­off rate. The fol­low­ing ta­ble shows the pay­offs and prob­a­bil­i­ties of each out­come:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-31-latex-2908102932.svg" alt="Figure 31" height="234"></figure><p>For our analy­sis, let’s use the fol­low­ing no­ta­tion to rep­re­sent the pay­off ma­trix above:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-32-latex-0290726690.svg" alt="Figure 32" height="150"></figure><p>No­tice that, like in the pre­vi­ous ex­am­ples, the sum of the prob­a­bil­i­ties adds up to one:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-33-latex-3477990014.svg" alt="Figure 33" height="53"></figure><p>Since there is a 10% chance that we can lose twice the bet size, there is an im­plic­it hard lim­it on the max­i­mum pos­si­ble bet size at 50%. We will ad­dress these kinds of lim­i­ta­tions in a lat­er sec­tion. For now, here is the growth rate func­tion that we want to max­i­mize:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-34-latex-3981404821.svg" alt="Figure 34" height="53"></figure><p>While there are six pos­si­ble out­comes in this ex­am­ple, there can be an ar­bi­trary num­ber of pos­si­ble out­comes in the gen­er­al case. Be­cause of this, it is best to rep­re­sent the growth rate func­tion as a sum­ma­tion. Here is a plot of the growth rate func­tion:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-35-example-3-gs.svg" alt="Figure 35" height="405" width="720"></figure><p>Now at this point, we might try the same ap­proach that we did be­fore in the last two ex­am­ples. We can take the de­riv­a­tive of the growth rate func­tion and then find the point at which the de­riv­a­tive is equal to ze­ro. But look at this de­riv­a­tive:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-36-latex-3362018836.svg" alt="Figure 36" height="53"></figure><p>Can you solve this? Go ahead and try it. But it might just be eas­i­er to use a nu­mer­i­cal root-find­ing method. And if you’re go­ing to use a nu­mer­i­cal method, you might al­so con­sid­er us­ing a nu­mer­i­cal op­ti­miza­tion method on the growth rate func­tion it­self in­stead of both­er­ing with the de­riv­a­tive. I de­cid­ed to use the Nelder–Mead method im­ple­ment­ed by a third-par­ty li­brary to find the bet size val­ue that max­i­mizes the growth rate func­tion. Here is the re­sult:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-37-latex-2185643889.svg" alt="Figure 37" height="16"></figure><p>And now, we can plug this val­ue in­to the growth rate func­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-38-latex-2537052427.svg" alt="Figure 38" height="45"></figure><p>For this game, the op­ti­mal bet size is 15.71%. The gam­bler can ex­pect to grow his wealth by 2.35% every round if he plays the op­ti­mal bet size. No­tice that, in this case, un­like the last two ex­am­ples, the bet size val­ue does not rep­re­sent the max­i­mum amount the gam­bler stands to lose. In­stead, it is sim­ply a mul­ti­pli­er or a scal­ing fac­tor. Based on the pay­off ma­trix for this par­tic­u­lar ex­am­ple, the gam­bler can lose up with twice the bet size on any giv­en round.</p><h2 id="stock-trading">Stock Trad­ing</h2><p>Now let’s see how to ap­ply this op­ti­mal bet siz­ing tech­nique to stock trad­ing. You can think of stock mar­ket trad­ing as a form of gam­bling. That is the best anal­o­gy. Sup­pose the gam­bler—or the trader, if you want to call him that—spec­u­lates that the price of a stock will close at one of six pos­si­ble price points af­ter a spe­cif­ic amount of time:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-39-latex-0131405676.svg" alt="Figure 39" height="150"></figure><p>The price points range from as low as $18 per share to as high as $23 per share, and the gam­bler’s hy­poth­e­sis as­so­ciates dif­fer­ent prob­a­bil­i­ties with each out­come. Let’s as­sume that the stock has a cur­rent mar­ket val­ue of $20 per share:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-40-latex-1003122082.svg" alt="Figure 40" height="14"></figure><p>This is the price point at which the trad­er can en­ter in­to a po­si­tion. To de­ter­mine the pay­off rate for each pos­si­ble out­come, we can use a pay­off func­tion that takes the en­try price in­to con­sid­er­a­tion. Here is the pay­off func­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-41-latex-2614500131.svg" alt="Figure 41" height="35"></figure><p>Here are the com­put­ed pay­off val­ues for each one of the pos­si­ble out­comes:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-42-latex-2333456418.svg" alt="Figure 42" height="152"></figure><p>Here is the growth rate func­tion that we want to max­i­mize:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-43-latex-0123407481.svg" alt="Figure 43" height="53"></figure><p>No­tice how the growth rate func­tion us­es the pay­off func­tion in­side the sum­ma­tion. Plot­ting this func­tion on a chart, here is what it looks like:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-44-example-4-gs.svg" alt="Figure 44" height="405" width="720"></figure><p>As with the pre­vi­ous ex­am­ple, we can use a nu­mer­i­cal op­ti­miza­tion method to find the most op­ti­mal bet size that max­i­mizes the growth rate. Here is the re­sult:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-45-latex-4142433282.svg" alt="Figure 45" height="16"></figure><p>This val­ue is greater than one. What does this mean? It means that our trad­er would have to use lever­age if he wants to take the most op­ti­mal po­si­tion in this stock. A trad­er with a $10,000 ac­count would have to buy $31,422 worth of this stock­—about 1,571 shares. Us­ing this amount of lever­age may or may not be pos­si­ble. As­sum­ing it is, here is the ex­pect­ed growth rate:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-46-latex-2537052427.svg" alt="Figure 46" height="45"></figure><p>No­tice the sim­i­lar­i­ty to the pre­vi­ous ex­am­ple. In fac­t, this is a re­peat of the pre­vi­ous ex­am­ple. The on­ly dif­fer­ence is that the pay­off val­ues are scaled down by a fac­tor of twen­ty. And this re­sults in the op­ti­mal bet size be­ing scaled up by a fac­tor of twen­ty. But the op­ti­mal growth rate re­mains the same for both ex­am­ples.</p><h2 id="continuous-distributions">Con­tin­u­ous Dis­tri­b­u­tions</h2><p>The pre­vi­ous ex­am­ple used what is ba­si­cal­ly a dis­crete prob­a­bil­i­ty mass func­tion to mod­el the pro­ject­ed be­hav­ior of stock price move­ments. Since stock prices can move along a con­tin­u­ous range of val­ues, it might be more re­al­is­tic to use a con­tin­u­ous mod­el in­stead of a dis­crete mod­el. In this ex­am­ple, we will use a log-nor­mal prob­a­bil­i­ty den­si­ty func­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-47-latex-2908599828.svg" alt="Figure 47" height="47"></figure><p>This func­tion ranges from ze­ro to in­fin­i­ty, and the area un­der the curve is one:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-48-latex-2899447321.svg" alt="Figure 48" height="50"></figure><p>For a log-nor­mal prob­a­bil­i­ty den­si­ty func­tion, we need to pro­vide ap­pro­pri­ate val­ues for the mean and the stan­dard de­vi­a­tion. How to come up with these val­ues is be­yond the scope of this dis­cus­sion, so we will just make up some fic­ti­tious num­bers for the sake of ex­am­ple:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-49-latex-2995049220.svg" alt="Figure 49" height="45"></figure><p>Us­ing these val­ues for the mean and stan­dard de­vi­a­tion, we can plot the prob­a­bil­i­ty den­si­ty func­tion to see what it looks like. Here is the plot:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-50-example-5-ps.svg" alt="Figure 50" height="405" width="720"></figure><p>This is our spec­u­la­tive fore­cast of what the stock price might be af­ter a spe­cif­ic amount of time has passed. As you can see from look­ing at the chart, the price is most like­ly to fall some­where be­tween $15 per share and $25 per share. But there is a small chance that it could fall out­side this range as well. For this ex­am­ple, we will as­sume the cur­rent price at which we can en­ter in­to a po­si­tion is $20 per share, and we will bound the ex­it point to some­where be­tween $17 per share and $23 per share:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-51-latex-4017371784.svg" alt="Figure 51" height="67"></figure><p>We are as­sum­ing ide­al­ized ex­it point bound­aries here. We can nev­er gain or lose more than $3 per share. In re­al­i­ty, en­force­ment of this bound­ary con­di­tion might take the form of a stop-loss or­der at $17 and a take-prof­it or­der at $23. Or it might al­so take the form of a long po­si­tion in a put op­tion with a strike price of $17 and a short po­si­tion in a call op­tion with a strike price of $23, dis­re­gard­ing any pre­mi­ums paid or re­ceived. Us­ing these val­ues, here is our pay­off func­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-52-latex-2476818120.svg" alt="Figure 52" height="136"></figure><p>This pay­off func­tion is a piece­wise func­tion that lim­its the loss and caps the gain at the ex­it point bound­aries. While this func­tion is not nec­es­sar­i­ly dif­fer­en­tiable at all points, note that it is con­tin­u­ous at all points. Here is a graph­i­cal rep­re­sen­ta­tion of this func­tion:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-53-example-5-ws.svg" alt="Figure 53" height="405" width="720"></figure><p>Giv­en the con­tin­u­ous prob­a­bil­i­ty den­si­ty func­tion and the con­tin­u­ous pay­off func­tion, we can now com­pute the ex­pect­ed growth rate as a func­tion of the bet size. In­stead of us­ing a sum­ma­tion as we did pre­vi­ous­ly, in this ex­am­ple, we will use an in­te­gral:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-54-latex-1515119160.svg" alt="Figure 54" height="50"></figure><p>This is the growth rate func­tion that we want to max­i­mize. Since the pay­off func­tion used here is a piece­wise func­tion, we might want to break this in­te­gral up in­to three dif­fer­ent par­ti­tion­s:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-55-latex-1328449645.svg" alt="Figure 55" height="50"></figure><p>I have not fig­ured out how to boil this in­te­gral down to an ex­pres­sion in an­a­lyt­ic for­m. In par­tic­u­lar, it is the mid­dle par­ti­tion I have not been able to find the so­lu­tion for. How­ev­er, this prob­lem can be solved us­ing nu­mer­i­cal in­te­gra­tion. In this case, I am us­ing the Gauss–Le­gendre method to find an ap­prox­i­ma­tion. Here is what this func­tion looks like on a chart:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-56-example-5-gs.svg" alt="Figure 56" height="405" width="720"></figure><p>Us­ing nu­mer­i­cal op­ti­miza­tion on top of nu­mer­i­cal in­te­gra­tion, we can com­pute the op­ti­mal bet size that max­i­mizes the growth rate func­tion. Here is the re­sult:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-57-latex-0108436737.svg" alt="Figure 57" height="16"></figure><p>Just like the pre­vi­ous ex­am­ple, this is a lever­aged po­si­tion. Here is the max­i­mum growth rate us­ing the op­ti­mal bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-58-latex-2226279349.svg" alt="Figure 58" height="45"></figure><p>Ad­mit­ted­ly, this ex­am­ple is a bit ide­al­is­tic. It as­sumes that the trad­er can re­peat the same bet again and again. But in re­al life, mar­ket con­di­tions can change over time. The price point where the trad­er can en­ter a po­si­tion can change as the tide of the mar­ket goes up and down, chang­ing the pay­off func­tion. And the prob­a­bil­i­ty dis­tri­b­u­tion of the pro­ject­ed price move­ments can change as well. In fac­t, the price move­ments might be dif­fi­cult to mod­el ac­cu­rate­ly in the first place.</p><h2 id="short-positions">Short Po­si­tions</h2><p>The op­ti­mal bet size does not al­ways have to be a pos­i­tive num­ber. Some­times it can be a neg­a­tive num­ber. A neg­a­tive num­ber can in­di­cate that the bet on of­fer is a los­ing bet that is not worth tak­ing. It might al­so rep­re­sent an op­por­tu­ni­ty for prof­it if the gam­bler is able to take the oth­er side of the bet. For a stock trader, a neg­a­tive val­ue in­di­cates that the most ad­van­ta­geous thing to do would be to take a short po­si­tion. Let’s re­peat the pre­vi­ous ex­am­ple us­ing a slight­ly dif­fer­ent prob­a­bil­i­ty den­si­ty func­tion. We’ll use the fol­low­ing mean and stan­dard de­vi­a­tion val­ues:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-59-latex-4148413365.svg" alt="Figure 59" height="45"></figure><p>Here is a plot of the log-nor­mal prob­a­bil­i­ty den­si­ty func­tion us­ing these val­ues:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-60-example-6-ps.svg" alt="Figure 60" height="405" width="720"></figure><p>The peak of the curve is shift­ed a bit to the left com­pared to the den­si­ty func­tion used in the pre­vi­ous ex­am­ple. For this ex­am­ple, we are go­ing to use the same en­try price and ex­it point bound­aries that we used in the pre­vi­ous ex­am­ple:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-61-latex-4017371784.svg" alt="Figure 61" height="67"></figure><p>As you might ex­pec­t, the pay­off func­tion is ex­act­ly the same as well:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-62-example-6-ws.svg" alt="Figure 62" height="405" width="720"></figure><p>The ex­pect­ed val­ue of the growth rate as a func­tion of the bet size looks like this:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-63-example-6-gs.svg" alt="Figure 63" height="405" width="720"></figure><p>No­tice the max­i­mum val­ue ap­pears on the neg­a­tive side of the ver­ti­cal ax­is this time around. Com­put­ing the op­ti­mal bet size nu­mer­i­cal­ly, this is the re­sult:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-64-latex-2407794594.svg" alt="Figure 64" height="15"></figure><p>It is a neg­a­tive num­ber, in­di­cat­ing that the trad­er should sell the stock short. Here is the ex­pect­ed growth rate cal­cu­la­tion if the trad­er takes the op­ti­mal­ly sized short po­si­tion:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-65-latex-3987495252.svg" alt="Figure 65" height="45"></figure><p>I think it’s worth men­tion­ing here that this re­sult is the po­lar op­po­site of the op­ti­mal bet size val­ue found in the pre­vi­ous ex­am­ple. This is sur­pris­ing be­cause these two ex­am­ples are near­ly iden­ti­cal. The on­ly dif­fer­ence is in the mean and stan­dard de­vi­a­tion val­ues used in the prob­a­bil­i­ty den­si­ty func­tion­s. And the dif­fer­ence is­n’t that great. The two prob­a­bil­i­ty den­si­ties are not that much dif­fer­ent from one an­oth­er. I think this il­lus­trates how sen­si­tive this bet size op­ti­miza­tion tech­nique is to the ac­cu­ra­cy of the mod­el used to quan­ti­fy the game.</p><h2 id="constraints-and-limitations">Con­straints and Lim­i­ta­tions</h2><p>As al­lud­ed to ear­li­er when dis­cussing mul­ti­ple out­comes, there are hard lim­its to how much a gam­bler can bet or how much lever­age a trad­er can use. When us­ing the Kel­ly cri­te­ri­on, if there is any chance at al­l, no mat­ter how small it might be, that the gam­bler can lose his en­tire stake on any one round of the game, then the ex­pect­ed growth rate is ze­ro. This is the ex­treme case of the gam­bler bet­ting an amount high­er in mag­ni­tude than the op­ti­mal bet size. In the stock trad­ing mod­el il­lus­trat­ed in the last two ex­am­ples, we must take these lim­its in­to con­sid­er­a­tion when al­low­ing the trad­er to take a lever­aged po­si­tion. Sup­pose a trad­er takes a po­si­tion in a stock at an en­try price of $20 per share:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-66-latex-1003122082.svg" alt="Figure 66" height="14"></figure><p>Set­ting the low­er ex­it point val­ue to $15 per share would con­strain the max­i­mum bet size for a long po­si­tion to four times the trad­er’s ac­count val­ue. If the trader were to lose more than $5 per share with this amount of lever­age, his ac­count would go in­to neg­a­tive ter­ri­to­ry. Like­wise, tak­ing a short po­si­tion with this amount of lever­age would con­strain the up­per ex­it point val­ue to no more than $25 per share. Here is how to cal­cu­late the ex­it point lim­its in re­la­tion to the bet size:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-67-latex-0521437764.svg" alt="Figure 67" height="172"></figure><p>For a long po­si­tion, there is ef­fec­tive­ly no lim­it to the up­per ex­it point. It can go to in­fin­i­ty. And for a short po­si­tion, the low­er ex­it point can go all the way to ze­ro with­out putting any re­stric­tions on the bet size. In the case of an un­lever­aged long po­si­tion, both the low­er and the up­per ex­it points can be un­lim­it­ed. Here is a plot of the for­mu­las above to give a vi­su­al il­lus­tra­tion:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-68-limitations-1.svg" alt="Figure 68" height="405" width="720"></figure><p>The sol­id lines show the hard lim­its that con­strain the up­per and low­er ex­it points. The shad­ed re­gions show the valid ar­eas where the ex­it points can be placed. But this does­n’t tell the whole sto­ry. The stock trader’s bro­ker might have mar­gin re­quire­ments that im­pose ad­di­tion­al con­straints on the above. Sup­pose the bro­ker has a 50% ini­tial mar­gin re­quire­ment to en­ter in­to a po­si­tion and a 25% main­te­nance mar­gin re­quire­men­t:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-69-latex-2518989079.svg" alt="Figure 69" height="41"></figure><p>The ini­tial mar­gin re­quire­ment puts a cap on the mag­ni­tude of the bet size. The al­low­able range of bet size val­ues is in­verse­ly pro­por­tion­al to the ini­tial mar­gin re­quire­men­t:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-70-latex-2064295291.svg" alt="Figure 70" height="18"></figure><p>We can al­so use the fol­low­ing no­ta­tion to de­scribe the ex­tremes of the bet size val­ues:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-71-latex-4016820844.svg" alt="Figure 71" height="50"></figure><p>Tak­ing the main­te­nance mar­gin re­quire­ment in­to con­sid­er­a­tion, we can now re­vise the for­mu­las for the ex­it point lim­it­s:</p><figure class="fig-latex"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-72-latex-1128790658.svg" alt="Figure 72" height="179"></figure><p>The mar­gin re­quire­ments add ad­di­tion­al con­straints both hor­i­zon­tal­ly and ver­ti­cal­ly. Here is the re­vised vi­su­al­iza­tion:</p><figure class="fig-chart" style="padding-top: 56.25%;"><img src="./2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/fig-73-limitations-2.svg" alt="Figure 73" height="405" width="720"></figure><p>As you can see, the range of ex­it point val­ues that would al­low the trad­er to avoid a mar­gin call is a sub­set of the range of val­ues that can be con­sid­ered un­der the Kel­ly cri­te­ri­on. To per­form the op­ti­mal bet size analy­sis un­der these con­straints, there are dif­fer­ent ap­proach­es you can take. You might try set­ting the ex­it point val­ues to the up­per and low­er lim­its for the most ex­treme bet size val­ues and then per­form­ing the op­ti­miza­tion pro­ce­dure to find the most op­ti­mal bet size across all pos­si­ble bet size val­ues. Al­ter­na­tive­ly, you might choose the ex­it point val­ues first based on some cri­te­ria and then lim­it the range of pos­si­ble bet size val­ues to those that al­low for the cho­sen range of ex­it points.</p><h2 id="psychology-and-variances">Psy­chol­o­gy and Vari­ances</h2><p>In ad­di­tion to the hard lim­its de­scribed above, there may al­so be some soft lim­its to how big the bet size can be. The fo­cus of this study has been on find­ing the most op­ti­mal bet size, but we did not ad­dress the vari­ance of pos­si­ble out­comes for a re­peat­ed bet­ting game. Even when there is a pos­i­tive ex­pec­ta­tion, the gam­bler may ex­pe­ri­ence los­ing streaks that cause him to sec­ond guess him­self. Tak­ing the most op­ti­mal bet size might be a psy­cho­log­i­cal­ly dif­fi­cult thing to do, and the gam­bler might be more com­fort­able tak­ing a small­er bet. It might be worth do­ing a fur­ther study to un­der­stand how much vari­a­tion the gam­bler might ex­pect in the pos­si­ble out­comes of play­ing a re­peat­ed game of chance.</p><p class="nojustify"><a href="https://github.com/jkillingsworth/jkillingsworth.com/tree/master/src/2022-06-06-using-the-kelly-criterion-for-optimal-bet-sizing">Ac­com­pa­ny­ing source code is avail­able on GitHub.</a></p><footer><time datetime="2022-06-06">June 6, 2022</time></footer></article><section class="comments"><header><h2>Com­ments</h2></header><script>
    var disqus_config = function () {
      this.page.url = "https://jkillingsworth.com/2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/";
      this.page.title = "Using the Kelly Criterion for Optimal Bet Sizing";
      this.page.identifier = "/2022/06/06/using-the-kelly-criterion-for-optimal-bet-sizing/";
    };
    function disqus_show() {
      var d = document, s = d.createElement("script");
      s.src = "https://jkillingsworth.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    }
    function anchor_blur() {
      var a = document.getElementById("comments");
      a.innerText = "Comments";
      a.blur();
    }
    function disqus() {
      disqus_show();
      anchor_blur();
    }
  </script><a href="javascript:disqus();" id="comments" class="button">Show comments</a><div id="disqus_thread"></div><noscript> Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></section></main><aside class="sidebar"><header><h1>Sidebar</h1></header><section class="social-media"><header><h2>Social Media</h2></header><ul><li><a href="https://www.linkedin.com/in/jkillingsworth/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M417.2 64H96.8C79.3 64 64 76.6 64 93.9V415c0 17.4 15.3 32.9 32.8 32.9h320.3c17.6 0 30.8-15.6 30.8-32.9V93.9C448 76.6 434.7 64 417.2 64zM183 384h-55V213h55v171zm-25.6-197h-.4c-17.6 0-29-13.1-29-29.5 0-16.7 11.7-29.5 29.7-29.5s29 12.7 29.4 29.5c0 16.4-11.4 29.5-29.7 29.5zM384 384h-55v-93.5c0-22.4-8-37.7-27.9-37.7-15.2 0-24.2 10.3-28.2 20.3-1.5 3.6-1.9 8.5-1.9 13.5V384h-55V213h55v23.8c8-11.4 20.5-27.8 49.6-27.8 36.1 0 63.4 23.8 63.4 75.1V384z"/></svg><span>LinkedIn</span></a></li><li><a href="https://github.com/jkillingsworth/"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32C132.3 32 32 134.9 32 261.7c0 101.5 64.2 187.5 153.2 217.9 1.4.3 2.6.4 3.8.4 8.3 0 11.5-6.1 11.5-11.4 0-5.5-.2-19.9-.3-39.1-8.4 1.9-15.9 2.7-22.6 2.7-43.1 0-52.9-33.5-52.9-33.5-10.2-26.5-24.9-33.6-24.9-33.6-19.5-13.7-.1-14.1 1.4-14.1h.1c22.5 2 34.3 23.8 34.3 23.8 11.2 19.6 26.2 25.1 39.6 25.1 10.5 0 20-3.4 25.6-6 2-14.8 7.8-24.9 14.2-30.7-49.7-5.8-102-25.5-102-113.5 0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8 0 0 1.6-.5 5-.5 8.1 0 26.4 3.1 56.6 24.1 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 30.2-21 48.5-24.1 56.6-24.1 3.4 0 5 .5 5 .5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6 0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5 0 30.7-.3 55.5-.3 63 0 5.4 3.1 11.5 11.4 11.5 1.2 0 2.6-.1 4-.4C415.9 449.2 480 363.1 480 261.7 480 134.9 379.7 32 256 32z"/></svg><span>GitHub</span></a></li></ul></section></aside><footer> &copy; 2018&ndash;2022 Jim Killingsworth. All rights reserved. </footer></body></html>